name: Gather indev
on:
    workflow_dispatch:
        # no params
    push:
        #
jobs:
    gather-indev:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout
            uses: actions/checkout@v2
            with:
                fetch-depth: 0

          - name: Post link
            if: 'false'
            env:
                DEPLOY_STATUS_WEBHOOK: ${{secrets.DEPLOY_STATUS_WEBHOOK}}
            run: |
                link="${{github.server_url}}/${{github.repository}}/actions/runs/${{github.run_id}}"
                message="[GATHER indev] Hello <$link>"
                ./ci/deploy/call_webhook.sh "$message"

          - name: Prepare
            run: |
                git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
                git config --local user.name "github-actions[bot]"
                git config pull.rebase false

                git remote add upstream https://github.com/skyrim-multiplayer/skymp

                git checkout -b indev

          - name: Gather and push
            env:
                DEPLOY_STATUS_WEBHOOK: ${{secrets.DEPLOY_STATUS_WEBHOOK}}
            run: |
                yarn --cwd="${{github.workspace}}/ci/deploy/gather-indev"
                ./ci/deploy/gather_indev.sh
                git push -u origin indev -f
